<!DOCTYPE html>
<html>
    <head>
        <title>
            Dolmenwood: What's on the Menu?
        </title>
        <script type="module" src="https://www.unpkg.com/vellum-doc@0.10.0/vellum-doc.js">
        </script>
        <link rel="stylesheet" href="css/style.css">
        <script lang="javascript">
            function dishLists() {
                return {
                    poorMain: [
                        "Battered pizzle",
                        "Blood porridge",
                        "Bubble and squeak",
                        "Dregger's pie",
                        "Fisher's gruel",
                        "Roast wellington",
                        "Special pasty",
                        "Woad in the hole"
                    ],
                    poorSide: [
                        "Codswallop",
                        "Pig's ear",
                        "Sourcroute",
                        "Wormskin"
                    ],
                    commonMain: [
                        "Mutton roast",
                        "Onion sandwich",
                        "Pook's pudding",
                        "Puggle pie",
                        "Sausage and mash",
                        "Shanky",
                        "Snail skewers",
                        "Trottel mash"
                    ],
                    commonSide: [
                        "Pickled eggs",
                        "Coldlanks",
                        "Hameth sprats",
                        "Ruddy chad"
                    ],
                    fancyMain: [
                        "Blackbird pie",
                        "Brathering",
                        "Jellied lamprey",
                        "Longmere pike",
                        "Maids-o'-the-lake",
                        "Roast lurkey",
                        "Unicorn rump",
                        "Whole suckling pig"
                    ],
                    fancySide: [
                        "Larks' tongues in aspic",
                        "Old Shuck",
                        "Sparrey",
                        "Vinegared troll moss"
                    ],
                    fancyDessert: [
                        "Fondant pastries",
                        "Sugared plums",
                        "Trifle",
                        "Walnut tarts"
                    ]
                }
            }

            function randomIntFromInterval(min, max) { // min and max included 
                return Math.floor(Math.random() * (max - min + 1) + min);
            }

            class FoodMenu extends HTMLElement {
                /*
                General kind of food menu. Uses attributes to choose the quality and type.
                */
                constructor () {
                    super()
                }

                connectedCallback() {
                    const quality = this.getAttribute("quality") // poor, common, fancy
                    const type = this.getAttribute("type") // main, side, dessert
                    const accessor = quality + String(type).charAt(0).toUpperCase() + String(type).slice(1)
                    const dishList = dishLists()[accessor]
                    const maxDishes = dishList.length / 2   // as long as the dish lists are all even!
                    const minDishes = maxDishes - 1

                    const shadowRoot = this.attachShadow({mode: "open"})
                    const style = document.createElement("style")
                    style.textContent = `
                        li.menu-item {
                            font-family: "Alegreya", serif;
                        }
                            ul.menu {
                            padding: 2em 0 2em 2em;
                            list-style: disc;
                            list-style-type: "\\2767  ";
                        }
                    `
                    const wrapper = document.createElement("section")

                    const numberDishes = randomIntFromInterval(minDishes,maxDishes)
                    
                    let dishes = []
                    const list = document.createElement("ul")
                    list.classList.add("menu")
                    while (dishes.length < numberDishes) {
                        const thisDish = dishList[Math.floor(Math.random()*dishList.length)]
                        if (!dishes.includes(thisDish)) {
                            dishes.push(thisDish)
                            let item = document.createElement("li")
                            item.classList.add("menu-item")
                            item.innerText = thisDish
                            list.appendChild(item)
                        }
                    }
                    wrapper.appendChild(list)
                    
                    shadowRoot.appendChild(style)
                    shadowRoot.appendChild(wrapper)
                }
            }
            customElements.define("food-menu", FoodMenu)
</script>
    </head>
    <body>
        <vellum-doc>
            <section id="document">
                <section>
                    <figure class="header">
                        <img src="img/Banquet_du_paon.jpg">
                    </figure>
                    <header>
                        <h1>On the Menu: What's for Dinner in Dolmenwood</h1>
                        <p>Being a generator of delectable delights for every budget.</p>
                    </header>
                </section>
                <section>
                    <h3 id="return" part="index-h3"><a href="index.html">Home</a> or: </h3>
                </section>
                <section>
                    <h1>Poor</h1>
                    <h2>Main Dishes</h2>
                    <food-menu quality="poor" type="main"></food-menu>
                    <h2>Side Dishes</h2>
                    <food-menu quality="poor" type="side"></food-menu>
                </section>
                <section>
                        <h1>Common</h1>
                        <h2>Main Dishes</h2>
                        <food-menu quality="common" type="main"></food-menu>
                        <h2>Side Dishes</h2>
                        <food-menu quality="common" type="side"></food-menu>
                </section>
                <section>
                        <h1>Fancy</h1>
                        <h2>Main Dishes</h2>
                        <food-menu quality="fancy" type="main"></food-menu>
                        <h2>Side Dishes</h2>
                        <food-menu quality="fancy" type="side"></food-menu>
                        <h2>Desserts</h2>
                        <food-menu quality="fancy" type="dessert"></food-menu>
                </section>
            </section>
        </vellum-doc>        
    </body>
</html>

